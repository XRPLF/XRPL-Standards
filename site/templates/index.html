{% extends "base.html" %}

{% block content %}
<div class="intro">
    <h2>XRP Ledger Standards (XLS)</h2>
    <p>XRP Ledger Standards (XLSes) describe standards and specifications relating to the XRP Ledger ecosystem that help achieve interoperability, compatibility, and excellent user experience.</p>
    <p>Total standards: <strong>{{ total_count }}</strong></p>
</div>

<div class="standards-table-container">
    <table class="standards-table" id="standardsTable">
        <thead>
            <tr>
                <th class="sortable" data-column="number">Number</th>
                <th class="sortable" data-column="title">Title</th>
                <th class="sortable" data-column="author">Author</th>
                <th class="sortable" data-column="status">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in xls_docs %}
            <tr class="status-{{ doc.status }}">
                <td class="number-col" data-label="Number" data-sort-value="{{ doc.number|int }}">
                    <a href="{{ base_url }}/xls/{{ doc.folder }}.html" class="xls-link">XLS-{{ doc.number }}</a>
                </td>
                <td class="title-col" data-label="Title" data-sort-value="{{ doc.title|lower }}">
                    <a href="{{ base_url }}/xls/{{ doc.folder }}.html">{{ doc.title }}</a>
                </td>
                <td class="author-col" data-label="Author" data-sort-value="{{ doc.author|lower }}">{{ doc.author }}</td>
                <td class="status-col" data-label="Status" data-sort-value="{{ doc.status|lower }}">
                    {% if doc.status == 'released' %}
                    <span class="status-badge released">Released</span>
                    {% elif doc.status == 'candidate' %}
                    <span class="status-badge candidate">Candidate</span>
                    {% elif doc.status == 'draft' %}
                    <span class="status-badge draft">Draft</span>
                    {% else %}
                    <span class="status-badge other">{{ doc.status.title() }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const table = document.getElementById('standardsTable');
    const headers = table.querySelectorAll('th.sortable');
    let currentSort = {column: 'number', direction: 'desc'}; // Default to reverse numerical order
    
    // Set initial sort indicator
    const numberHeader = table.querySelector('th[data-column="number"]');
    numberHeader.classList.add('sort-desc');
    
    headers.forEach(header => {
        header.addEventListener('click', function() {
            const column = this.dataset.column;
            let direction = 'asc';
            
            // Toggle direction if clicking the same column
            if (currentSort.column === column && currentSort.direction === 'asc') {
                direction = 'desc';
            }
            
            sortTable(column, direction);
            updateSortIndicators(this, direction);
            
            currentSort = {column, direction};
        });
    });
    
    function sortTable(column, direction) {
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        rows.sort((a, b) => {
            let aVal, bVal;
            
            if (column === 'number') {
                aVal = parseInt(a.querySelector(`td[data-label="${column.charAt(0).toUpperCase() + column.slice(1)}"]`).dataset.sortValue);
                bVal = parseInt(b.querySelector(`td[data-label="${column.charAt(0).toUpperCase() + column.slice(1)}"]`).dataset.sortValue);
            } else {
                aVal = a.querySelector(`td[data-label="${column.charAt(0).toUpperCase() + column.slice(1)}"]`).dataset.sortValue;
                bVal = b.querySelector(`td[data-label="${column.charAt(0).toUpperCase() + column.slice(1)}"]`).dataset.sortValue;
            }
            
            if (direction === 'asc') {
                return aVal > bVal ? 1 : -1;
            } else {
                return aVal < bVal ? 1 : -1;
            }
        });
        
        // Re-append sorted rows
        rows.forEach(row => tbody.appendChild(row));
    }
    
    function updateSortIndicators(activeHeader, direction) {
        // Clear all sort indicators
        headers.forEach(h => {
            h.classList.remove('sort-asc', 'sort-desc');
        });
        
        // Add indicator to active header
        activeHeader.classList.add(`sort-${direction}`);
    }
});
</script>
{% endblock %}